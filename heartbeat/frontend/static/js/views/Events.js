import AbstractView from "./AbstractView.js";
import EventManager from "../managers/EventManager.js";
import RightSidebar from "./_RightSidebar.js";
export default class extends AbstractView {
    constructor(params) {
        super(params);
        this.setTitle("Events");
    }

    async getHtml() {
        return `
            <h2 class="page-title"><i class="fa-solid fa-calendar-days fa-fw"></i> Events</h2>
            <div class="event-controls">
                <div class="search-bar">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" id="event-search" placeholder="Search events...">
                </div>
                <div class="month-selector" id="month-selector">
                    <!-- Months will be generated by JS -->
                </div>
                <button id="clear-filter-btn" class="clear-filter-btn" data-tooltip="Show all events"><i class="fa-solid fa-xmark fa-fw"></i> Clear Filter</button>
                <button id="create-event-btn" class="form-button" data-tooltip="Create a new event"><i class="fa-solid fa-plus fa-fw"></i> Create Event</button>
            </div>
            <div class="event-grid" id="event-container">
                <!-- Events will be rendered here -->
            </div>
        `;
    }

    async after_render() {
        const eventManager = new EventManager('event-container');

        document.getElementById('create-event-btn').addEventListener('click', () => {
            eventManager.showCreateModal();
        });

        const searchInput = document.getElementById('event-search');
        searchInput.addEventListener('input', () => {
            const month = document.querySelector('.month-selector button.is-active')?.dataset.month || 'all';
            eventManager.filterEvents(searchInput.value, month);
        });

        const monthSelector = document.getElementById('month-selector');
        const clearFilterBtn = document.getElementById('clear-filter-btn');
        const months = ["All", "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        monthSelector.innerHTML = months.map((m, i) => `<button data-month="${i === 0 ? 'all' : i - 1}" class="${i === 0 ? 'is-active' : ''}">${m}</button>`).join('');
        
        monthSelector.querySelectorAll('button').forEach(btn => {
            btn.addEventListener('click', () => {
                monthSelector.querySelector('.is-active').classList.remove('is-active');
                btn.classList.add('is-active');
                clearFilterBtn.classList.toggle('is-visible', btn.dataset.month !== 'all');
                eventManager.filterEvents(searchInput.value, btn.dataset.month);
            });
        });

        clearFilterBtn.addEventListener('click', () => {
            monthSelector.querySelector('button[data-month="all"]').click();
        });
    }
}