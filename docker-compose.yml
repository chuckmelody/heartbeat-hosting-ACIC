services:
    heartbeat-frontend:
      build:
        context: ./heartbeat
      container_name: heartbeat_frontend_service
      restart: unless-stopped
      expose:
        - '3230'
      networks:
        - heartbeat-backend-net

    nginx:
      image: nginx:1.25
      container_name: heartbeat-nginx
      restart: unless-stopped
      depends_on:
        heartbeat-frontend:
          condition: service_started
      ports:
        - "80:80"
        - "443:443"
      volumes:
        - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
        - ./nginx/dhparam.pem:/etc/nginx/ssl/dhparam.pem:ro
        - /etc/letsencrypt/live/heartbeatacic.org/fullchain.pem:/etc/nginx/ssl/cert.pem:ro
        - /etc/letsencrypt/live/heartbeatacic.org/privkey.pem:/etc/nginx/ssl/key.pem:ro
        - ./heartbeat/cert.pem:/etc/nginx/ssl/dev-cert.pem:ro
        - ./heartbeat/key.pem:/etc/nginx/ssl/dev-key.pem:ro
      networks:
        - heartbeat-backend-net

    it-tools:
      build:
        context: ./docker/it-tools
        args:
          IT_TOOLS_IMAGE: ghcr.io/corentinth/it-tools:latest
          IT_TOOLS_BASE: /tools/it-tools/
      image: hosting-it-tools:latest
      container_name: heartbeat-it-tools
      restart: unless-stopped
      expose:
        - "80"
      networks:
        - heartbeat-backend-net

networks:
  heartbeat-backend-net:
    driver: bridge
